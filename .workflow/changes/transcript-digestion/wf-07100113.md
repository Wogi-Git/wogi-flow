# [wf-07100113] Fix Critical Bugs in Transcript Digestion Skill

## User Story

**As a** developer using the Transcript Digestion skill
**I want** the skill to handle edge cases and error conditions gracefully
**So that** the system doesn't crash during transcript processing

## Description

The Transcript Digestion skill (scripts/flow-transcript-digest.js) has 5 critical bugs identified during code inspection that can cause runtime crashes or infinite loops. These bugs affect the reliability of the multi-pass extraction system and need to be fixed to ensure production stability.

## Acceptance Criteria

### Scenario 1: Null clarifications handling
**Given** loadClarifications() returns null (no clarifications file exists)
**When** generateAllQuestions() is called
**Then** the function initializes an empty clarifications structure and continues without crashing

### Scenario 2: Infinite loop prevention in chunking
**Given** a SPEAKER_BOUNDARY_PATTERNS regex without the global flag
**When** findNaturalBoundary() is called
**Then** the function should not enter an infinite loop and returns valid boundary

### Scenario 3: Empty orphans array handling
**Given** an empty orphans array is passed to createTopicFromOrphans()
**When** the function attempts to extract a key phrase
**Then** the function returns gracefully with a default topic name instead of crashing

### Scenario 4: Malformed VTT input handling
**Given** a VTT file with invalid timestamp format
**When** parseVTT() processes the content
**Then** the function handles the error gracefully and returns partial results or error message

### Scenario 5: Malformed SRT input handling
**Given** an SRT file with missing sequence numbers
**When** parseSRT() processes the content
**Then** the function handles the error gracefully and returns partial results or error message

## Technical Notes

### Files to Modify
- `scripts/flow-transcript-digest.js`

### Specific Line Fixes
1. **Lines 3059-3066**: Add null check for clarifications before using
2. **Lines 2446-2450**: Ensure regex has global flag before exec loop, add safety counter
3. **Line 790**: Add bounds check before accessing orphans[0]
4. **Lines 5439-5533**: Add try/catch and input validation to parseVTT()
5. **Lines 5538-5600**: Add try/catch and input validation to parseSRT()

### Existing Components
- All fixes are within flow-transcript-digest.js
- No new files needed

## Test Strategy

### Unit Tests (Manual CLI)
- Test `needs-chunking` with empty input
- Test `plan-chunks` with malformed text
- Test VTT/SRT parsing with invalid files

### Verification Commands
```bash
# Syntax check
node --check scripts/flow-transcript-digest.js

# Test empty input
echo "" | node scripts/flow-transcript-digest.js needs-chunking -

# Test chunking
echo "Test text" | node scripts/flow-transcript-digest.js plan-chunks -
```

## Dependencies
- None - these are bug fixes to existing code

## Complexity
**Medium** - 5 targeted fixes in a single file, requires careful validation

## Priority
**P0** - Critical bugs that can cause crashes
