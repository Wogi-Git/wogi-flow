#!/bin/bash

# Wogi Flow - Create New Feature

set -e

WORKFLOW_DIR=".workflow"

# Colors
GREEN='\033[0;32m'
CYAN='\033[0;36m'
NC='\033[0m'

if [ -z "$1" ]; then
    echo "Usage: flow new-feature <feature-name>"
    exit 1
fi

FEATURE_NAME="$1"
FEATURE_DIR="$WORKFLOW_DIR/changes/$FEATURE_NAME"

if [ -d "$FEATURE_DIR" ]; then
    echo "Feature '$FEATURE_NAME' already exists"
    exit 1
fi

mkdir -p "$FEATURE_DIR/specs"

# Create proposal.md
cat > "$FEATURE_DIR/proposal.md" << EOF
# Feature: $FEATURE_NAME

## Summary
[Brief description of the feature]

## Problem
[What problem does this solve?]

## Solution
[How will this feature solve the problem?]

## User Stories
- As a [user], I want to [action] so that [benefit]

## Acceptance Criteria
- [ ] [Criterion 1]
- [ ] [Criterion 2]

## Dependencies
- [List any dependencies]

## Technical Notes
[Any technical considerations]
EOF

# Create tasks.json
cat > "$FEATURE_DIR/tasks.json" << EOF
{
  "feature": "$FEATURE_NAME",
  "created": "$(date -Iseconds)",
  "tasks": [
    {
      "id": "TASK-001",
      "title": "[First task]",
      "type": "feature",
      "status": "pending",
      "priority": "high",
      "dependencies": [],
      "acceptanceCriteria": [
        "[Criterion 1]"
      ]
    }
  ]
}
EOF

echo -e "${GREEN}âœ“ Created feature: $FEATURE_NAME${NC}"
echo ""
echo "Files created:"
echo -e "  ${CYAN}$FEATURE_DIR/proposal.md${NC}"
echo -e "  ${CYAN}$FEATURE_DIR/tasks.json${NC}"
echo ""
echo "Next steps:"
echo "  1. Edit proposal.md with feature details"
echo "  2. Add tasks to tasks.json"
echo "  3. Run: ./scripts/flow ready"
