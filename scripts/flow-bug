#!/bin/bash

# Wogi Flow - Create Bug Report

set -e

WORKFLOW_DIR=".workflow"
BUGS_DIR="$WORKFLOW_DIR/bugs"

# Colors
GREEN='\033[0;32m'
CYAN='\033[0;36m'
NC='\033[0m'

if [ -z "$1" ]; then
    echo "Usage: flow bug <title>"
    exit 1
fi

TITLE="$1"

mkdir -p "$BUGS_DIR"

# Find next bug number
LAST_BUG=$(ls "$BUGS_DIR"/BUG-*.md 2>/dev/null | sort -V | tail -1 | grep -oE "[0-9]+" || echo "0")
NEXT_NUM=$((LAST_BUG + 1))
BUG_ID=$(printf "BUG-%03d" $NEXT_NUM)

BUG_FILE="$BUGS_DIR/$BUG_ID.md"

cat > "$BUG_FILE" << EOF
# $BUG_ID: $TITLE

**Created**: $(date +%Y-%m-%d)
**Status**: Open
**Severity**: Medium
**Tags**: #bug

## Description
[Describe the bug]

## Steps to Reproduce
1. [Step 1]
2. [Step 2]
3. [Step 3]

## Expected Behavior
[What should happen]

## Actual Behavior
[What actually happens]

## Environment
- Browser: 
- OS: 
- Version: 

## Screenshots
[If applicable]

## Possible Fix
[If you have ideas]

## Related
- [Related issues or files]
EOF

echo -e "${GREEN}âœ“ Created: $BUG_ID${NC}"
echo -e "  ${CYAN}$BUG_FILE${NC}"
echo ""
echo "Title: $TITLE"
